<!doctype html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="format-detection" content="telephone=no">
  <link rel="stylesheet" href="../public/tailwind.css" charset="utf-8">
  <link rel="stylesheet" href="../public/post.css" charset="utf-8">
  <title>desktop linux is insecure - Bjorn Pagen</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5RPHJQQDZY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5RPHJQQDZY');
  </script>
</head>

<body class="body-text_plex-serif">
  <main>
    <header>
      <time datetime="2023-06-11 07:53:33Z">
        6月 11 2023
      </time>
      <topic>
        desktop linux is insecure
      </topic>
    </header>
    <article>
      <p>デスクトップLinuxディストリビューションは、Debian、Fedora、
Ubuntu、Arch、Gentooなど、基本的なセキュリティ原則が
完全に無視されている。</p>
<p>これは、一般的なLinux愛好家の
ドグマとはまったく異なります。<em>誰もが分かっている</em>のは、Windowsはセキュリティが低い、でしょ？
Linuxはオープンソース™で、誰もがコードを見て
バグを修正できる、でしょ？</p>
<h2 id="heading">セキュリティについて</h2>
<p>実際、エクスプロイトはバグを利用するプログラムです。エクスプロイトを最小限に抑えるには、バグを最小限に抑えます。</p>
<p>ソフトウェアのバグは複雑さから来ます。ソフトウェアを構成するソフトウェアスタックは、
必然的に複雑さの積み重ねがあります：それらは<em>難しい</em>問題を解決し、
そのために多くのコードが必要です。たとえば、TCPとSSLは、
正しく実装するためにエンジニアのチーム努力が必要な高度に複雑なプロトコルです。</p>
<p>私たちのソフトウェアがすべてバグを持っていることを、
かなり合理的に期待しています。すべてを正式に検証するという考えは、
主に、フォーマルな検証が遅く、コストがかかるため、
夢物語です。</p>
<p>サーバーワールドが、コンテナーと
Kubernetesのようなデプロイメントフレームワークで、完全に<strong>サンドボックス</strong>の
概念を受け入れたのも驚くべきことではありません。論理的には&mdash;我々は
ソフトウェアが安全であることを保証できないので、それを分離し、
システムの他の部分から副作用を隔離します。</p>
<h2 id="heading-1">アプリレベルのサンドボックス化</h2>
<p>Chromeのブラウザの例を取ります。GUI、
HTMLレンダラ、V8 JavaScriptエンジン、ブラウザ拡張&mdash;すべて
Chromeのこれらの部分は個々に巨大なコードの山です。つまり、これらのコンポーネントはすべて、異なるオペレーティングシステムプロセスに分かれて存在し、IPCメカニズムを介してしか互いに話すことができません。</p>
<p>このようにして、悪意のあるウェブサイトがあなたのホームディレクトリにアクセスできないようにします。Chromiumは、GUI部分だけがアクセスしています。
GUI（正式には <code>Browser</code> プロセスと呼ばれます）は、
あなたのホームディレクトリにアクセスできる唯一の部分です。従って、レンダラーは「サンドボックス化」されています。</p>
<p>ただし、これで完全に安全になったわけではありません。サンドボックスは完璧ではなく、
分離メカニズムのバグが侵入したコードをシステムの他の部分に<em>脱出</em>させるだけです。攻撃者がHTMLレンダラーをエクスプロイトする方法を見つけた場合、IPCメカニズムを使用してGUIをエクスプロイトしようとすることができます。これは、エクスプロイト<strong>チェーン</strong>と呼ばれます。</p>
<p>これは非常に一般的であり、すべての現代的なエクスプロイトは次々と連鎖する
エクスプロイトです。上記のシナリオとほぼ同じように動作するAndroidの完全
エクスプロイトチェーンについては、<a href="https://github.blog/2021-03-24-real-world-exploit-chains-explained/">ここ</a>で説明されています。</p>
<h2 id="heading-2">ゲームオーバー</h2>
<p>レンダラーエクスプロイトとGUIエクスプロイトが
連鎖された場合、あなたはユーザーとして何でもできる悪意のあるプロセスを抱えることになります。これでゲームオーバーです。</p>
<p>キーロガーをインストールすることができます。
画面を録画し、静かにrootパスワードを
入力するのを待って、rootシェルを表示します。</p>
<p>この時点で、攻撃者はさらにカーネルをエクスプロイトして、
ファームウェアにハッキングして、デバイスを壊したり、永続的な
バックドアをインストールしたりすることができます。</p>
<p>少なくとも、これは10年前の状況でした。エクスプロイトがそんなに簡単ではないように、ほとんどの現代のデスクトップオペレーティングシステムは
<em>独自の</em>サンドボックスを実装し、Chromeアプリ全体を
システムのその他の部分から分離します。このように、ドゥームズデイシナリオを作成するために追加の努力が必要になります。</p>
<h2 id="heading-3">適切なサンドボックス化</h2>
<p>現代の「Linuxディストリビューション」で、実際にサンドボックス化が
非常にうまく機能しているのはChromeOSです。Chromeが独自の小さな世界にとどまるように、ChromeOSが実装する<a href="https://www.chromium.org/chromium-os/chromiumos-design-docs/system-hardening/">戦略の聖書</a>があります。
cgroups、namespacing、seccompなどの戦略が含まれます。この技術は基本的にDockerと同じことを行います(修正済み)。
Chromeは、明示的な許可を与えられるまで、ファイルにアクセスできませんし、他のプログラムを実行したり、ハードドライブを消去したりすることはできません。</p>
<p>Chromeだけでなく、ChromeOSでは<em>すべての</em>重要なシステムプロセスが
サンドボックス化されています。システムロガー、ディスプレイサーバー、
wifiデーモンなどです。これらのさまざまなサービスの
攻撃面を最小限に抑えるための多くの設計が行われており、可能な限り最小限の権限しか与えられません。これは
<strong>最小限の特権の原則</strong>です。</p>
<p>各プロセスは、実行に必要な最低限のものに
ファイルシステムのビューが削られています。承認されていない限り、新しいネットワークリクエストを作成することはできません。 <code>/dev/sda</code> のようなLinuxデバイスノードにアクセスできません。
自分のプロセスツリーでPID 1として実行するため、他のプロセスの情報にアクセスできません。許可されている以上のメモリを割り当てることもできません。</p>
<p>もちろん、サンドボックス化が<em>すべて</em>ではありません。さまざまな<a href="../en_US/mitigations.html">緩和策</a>と追加の詳細があります。緩和策は、特にCやC ++などのメモリ安全でない言語向けで、あるバグに対するエクスプロイトを開発する際に攻撃者により困難になります。</p>
<p>MacOS、OpenBSD、Windowsもすべてサンドボックス化で大きな進歩を遂げています。ChromeOSが最も優れているのは、最新であり、最初から安全に設計されており、仮想化されていないユーザーソフトウェアは許可されていません。</p>
<h2 id="heading-4">不適切なサンドボックス化</h2>
<p>上で述べた悪意あるChromeプロセスが全システムを制御できるようになる、10年前の状況を覚えていますか？ 現代のLinuxデスクトップは今もそこにあります。</p>
<p>ここには、他のすべてのデスクトップLinuxディストリビューションがあります。Debian、Fedora、Ubuntu、Arch、Gentooは、<em>ゼロ</em>の意味のあるシステムレベルのサンドボックス化があります。</p>
<p>一般的に、ディストリビューションはサンドボックス化を実装せず、セキュリティポリシーを設定し実施するユーザーに任せています。そのため、デフォルトで <code>chromium</code> をインストールすると、Chromiumのデフォルト設定を超える追加のサンドボックス化は <em>ゼロ</em> になります。ChromeOSとは対照的に、Chromeは明示的な許可がない場合でも、すべての個人ファイルを参照できます。</p>
<p>メンテナが過ちを犯すわけではありません。メンテナは、依存関係やサービスがアクセスする必要のあるリソースについて十分に知識がありません。一方、開発者は自分のソフトウェアが実行される状況を知らず、ポータブルなプログラムをリリースする必要があります。そのため、開発者はプログラムがシステムとの間でどのような権限を必要とするかを想定できません。</p>
<p>また、Linuxのデスクトップソフトウェアは権限に関して非常に<em>全てか無かった</em>アプローチがあります。
ルートかユーザー。パッケージをインストールしたいですか？<code>sudo apt</code>、<code>sudo dnf</code>、<code>sudo pacman</code>が適切です。
ユーザーソフトウェアをインストールするのに、システムのアップグレードにroot権限が必要な理由は本当にありません。<a href="https://nixos.org">NixOS</a>はこの概念を探求しましたが、まったく理解できない設定形式です。</p>
<p>sudoの乱用は、ユーザーとルート間の分離を本当にゼロにまで劣化させます。キーロガーをインストールするのは <a href="https://github.com/Aishou/wayland-keylogger">Waylandでも</a>難しくありません。</p>
<h2 id="heading-5">改善の可能性</h2>
<p>Linuxのサンドボックス化問題への一般的なアプローチはすべて不十分です。</p>
<p>Flatpakは <em>システム</em>のサンドボックス化の問題を忘れています。これらの技術を使用しても、コアOSを構成するソフトウェアのベース配信がまったくサンドボックス化されず、<a href="https://github.com/flatpak/flatpak/issues/4983">Flatpak</a>が最初からセキュリティコンテナとしての実行可能性に対して多くの批判があります。</p>
<p>実装の品質については全くわかりませんが、systemdサービスファイルは、宣言的にnamespacingおよびsandboxingフラグをサポートしています。ただし、Linuxディストリビューションはこれらをまったく使用しておらず、ChromeOSの<a href="https://github.com/google/minijail">minijail</a>ほど包括的ではありません。</p>
<p>Firejailはrootとして実行され、<a href="https://www.cvedetails.com/cve/CVE-2019-12499/">特権昇格バグ</a>の道を開きました。</p>
<p>Pipewireは、Linuxのオーディオ問題に対する良い解決策であり、機能指向設計によりより良いサンドボックス化が可能になりました。これは、将来適切なサンドボックス化が可能になるための作業を助けるものです。</p>
<h2 id="heading-6">新しいディストリビューション？</h2>
<p>これらの問題を修正するLinuxディストリビューションを考えるのは面白いです。私は少し<a href="../en_US/secure%20linux%20desktop.html">セキュアなLinuxデスクトップ</a>について考えましたが、それは時間の無駄ですよね？</p>

    </article>
    <sig><a href="index.html">Bjorn Pagen</a></sig>
  </main>
</body>

</html>